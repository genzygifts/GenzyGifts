<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Diwali Special Wish and Gift Offer</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<meta property="og:title" id="og-title-meta" content="|| ü•∞‚õÑ ‡§Ü‡§™‡§ï‡•ã ‡§î‡§∞ ‡§Ü‡§™‡§ï‡•á ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§Æ‡•á‡§∞‡•Ä ‡§ì‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§≠ ‡§¶‡•Ä‡§™‡§æ‡§µ‡§≤‡•Ä üå∑üíù || ‡§Æ‡§æ‡§Å ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä ‡§î‡§∞ ‡§ó‡§£‡•á‡§∂ ‡§ú‡•Ä ‡§ï‡•Ä ‡§ï‡•É‡§™‡§æ ‡§Ü‡§™ ‡§™‡§∞ ‡§∏‡§¶‡§æ ‡§¨‡§®‡•Ä ‡§∞‡§π‡•á üå∑üôè ||">
<meta property="og:description" id="og-description-meta" content="‡§Ö‡§™‡§®‡•á ‡§®‡§æ‡§Æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ö‡§™‡§®‡•ã‡§Ç ‡§ï‡•ã (Wish Share) ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è SEND ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§">
<meta property="og:image" id="og-image-meta" content="https://genzygifts.github.io/GenzyGifts/diwali.gif"> 
<meta property="og:url" id="og-url-meta" content="https://genzygifts.github.io/GenzyGifts/">
<meta property="og:type" content="website">
<style>
/* --- VARIABLES --- */
:root {
--color-background-start: #FF7F50; 
--color-background-end: #CC3333; 
--color-card-bg: #ffffff;
--color-primary-text: #000000;
--color-primary-btn: #FF6B00; 
--color-price-main: #8B0000;
--color-price-cod: #dc3545; 
--color-price-premium: #FF6B00; 
--color-header-star: #FFD700; 
--color-header-text: #FFE4B5; 
--spacing-unit: 8px;
}
/* --- GLOBAL RESET & 9:16 CONTAINER LOGIC (FIXED) --- */
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
html, body { 
    height: 100%; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    background: #000; 
}
#app-container { 
    width: 100%; 
    height: 100%; 
    max-width: calc(100vh * 9 / 16); 
    max-height: 100vh;
    margin: auto;
    display: flex; 
    flex-direction: column; 
    background: linear-gradient(180deg, var(--color-background-start) 0%, var(--color-background-end) 100%); 
    box-shadow: 0 0 40px rgba(255, 107, 53, 0.6); 
    color: var(--color-primary-text); 
    position: relative; 
}
/* FIX: Added overflow-y to content-area for scroll capability */
#content-area { 
    padding: 0 var(--spacing-unit); 
    text-align: center; 
    flex-grow: 1; 
    display: flex;
    flex-direction: column;
    justify-content: space-between; 
    overflow-y: auto; 
    overflow-x: hidden;
    padding-bottom: 5px; 
}
/* --- DECORATIONS (Same as before) --- */
.diya-decoration { position: absolute; top: 1vh; font-size: 2.5em; z-index: 20; text-shadow: 0 0 10px var(--color-header-star); animation: pulse 2s infinite alternate; }
.diya-left { left: 10px; transform: rotate(-15deg); }
.diya-right { right: 10px; transform: rotate(15deg); }
@keyframes pulse {
0% { transform: scale(1); opacity: 0.9; }
100% { transform: scale(1.1); opacity: 1; }
}
/* --- HEADER STYLES --- */
#top-header-wish { text-align: center; padding: calc(var(--spacing-unit) * 2) 0 var(--spacing-unit) 0; color: var(--color-header-text); font-weight: 600; position: relative; z-index: 10; flex-shrink: 0; }
.receiver-header { font-size: 2.1em; font-weight: 900; color:var(--color-header-star); text-shadow: 2px 2px 5px rgba(0,0,0,0.7); } 
.festival-text { font-size: 1.5em; font-weight: 700; margin-bottom: 5px; display: flex; justify-content: center; align-items: center; } 
.store-title-top { font-size: 1.2em; font-style: italic; font-weight: 600; letter-spacing: 1px; color: #FFE4B5; opacity: 0.8; margin-bottom: var(--spacing-unit); } 
/* --- PRODUCT CARD --- */
#product-card { 
    background-color: var(--color-card-bg); 
    border-radius: 15px; 
    padding: var(--spacing-unit); 
    margin-top: 5px; 
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); 
    text-align: left; 
    flex-shrink: 0; 
}
.product-name-main { font-size: 1.0em; font-weight: 700; margin-bottom: 3px; text-align: center; }
#review-bar { text-align: center; margin-bottom: 5px; color: #FFD700; font-size: 1.0em; }
#media-box { width: 100%; padding-top: 56.25%; height: 0; margin-bottom: 8px; border: 1px solid #ddd; position: relative; border-radius: 8px; overflow: hidden;}
.carousel-image, .product-media-video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: opacity 0.5s ease-in-out; }
.product-media-video { object-fit: contain; }
#price-container { display: flex; justify-content: space-around; margin-bottom: 8px; text-align: center; border: 1px solid #f0f0f0; border-radius: 8px; padding: 5px 0;} 
.price-label { font-size: 0.75em; } 
.price-value { font-size: 1.3em; font-weight: 900; }
#price-cod-display .price-value { color: var(--color-price-cod); }
#price-premium-display .price-value { color: var(--color-price-premium); }
#description-text { font-size: 0.8em; color: #444; margin-bottom: 8px; font-weight: 500; text-align: center; }
/* --- BUTTONS & INPUTS --- */
.btn-base { width: 100%; padding: 10px 15px; margin-bottom: 5px; border-radius: 20px; font-size: 0.9em; font-weight: 700; border: none; cursor: pointer; transition: all 0.3s; }
.primary-btn { 
    background: linear-gradient(135deg, var(--color-primary-btn), #FF4500); 
    color: white; box-shadow: 0 4px 10px rgba(255, 107, 0, 0.5); 
}
input[type="text"], textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 0.95em; outline: none; }
/* --- SHARE SECTION --- */
#share-section-box { 
    padding: var(--spacing-unit); 
    margin-top: 5px; 
    background-color: #f8f8f8; 
    border-radius: 8px; 
    flex-shrink: 0; 
}
#share-label { font-size: 0.85em; font-weight: 600; margin-bottom: 5px; display: flex; align-items: center; }
#offer-timer-share { display: flex; align-items: center; justify-content: space-between; background-color: #fff3cd; border: 1px solid #ffeeba; border-radius: 8px; padding: 5px 8px; margin-bottom: 5px; } 
#offer-end-text { font-size: 0.8em; font-weight: 700; color: #856404; flex-shrink: 0; margin-right: 5px; } 
#countdown { font-size: 1.0em; font-weight: 900; color: #dc3545; } 
.share-input-row { display: flex; gap: 8px; margin-bottom: 5px; }
.share-input-field { flex-grow: 1; padding: 6px; border-radius: 6px; border: 2px solid #FF8C00; font-size: 0.8em; outline: none; text-align: center; } 
.share-btn { width: 100%; padding: 8px; background: linear-gradient(135deg, #FF8C00, #FF6B00); color: white; flex-shrink: 0; border-radius: 8px; font-size: 0.9em; font-weight: 700; border: none; cursor: pointer; margin-top: 5px;} 
/* --- SCRIPT PURCHASE BOX --- */
#script-purchase-box { 
    padding: var(--spacing-unit); 
    margin-top: 8px; 
    background: rgba(220, 220, 220, 0.9); 
    border-radius: 8px; 
    flex-shrink: 0; 
    display: flex; justify-content: space-between; align-items: center; }
.script-text-group { flex-grow: 1; }
.script-info { font-size: 0.8em; margin-bottom: 5px; font-weight: 600; color: #000;} 
.script-btn { padding: 6px 10px; font-size: 0.7em; } 
.qr-code-display img { width: 60px; height: 60px; border: 2px solid #FFD700; border-radius: 5px; } 
.qr-code-label { font-size: 0.6em; } 
.hidden { display: none !important; }
/* --- MODAL STYLES --- */
#modal { position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; }
.modal-content { background-color: var(--color-card-bg); padding: 20px; border-radius: 15px; width: 90%; max-width: 380px; position: relative; color: var(--color-primary-text); box-shadow: 0 10px 40px rgba(255, 107, 53, 0.5); overflow-y: auto; max-height: 90vh; }
.modal-content .close-btn { position: absolute; top: 10px; right: 12px; font-size: 24px; cursor: pointer; color: #999; }
</style>
</head>
<body onclick="attemptAudioPlay()">
<div id="app-container">
<span class="diya-decoration diya-left">ü™î</span>
<span class="diya-decoration diya-right">ü™î</span>
<div id="top-header-wish">
<h1 class="receiver-header">Hi <span id="receiver-display-top">Priya</span>!</h1>
<p class="festival-text">Happy Diwali ‚ú® <i class="fas fa-volume-up" onclick="attemptAudioPlay(true)"></i></p>
<h2 class="store-title-top">+ Genzy Gifts +</h2>
</div>
<div id="content-area">
<div id="product-card">
<h4 id="product-name-static" class="product-name-main">Loading Product...</h4>
<div id="review-bar">
<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
<span style="color: #666; font-size: 0.9em; font-weight: 600; margin-left: 8px;">(154 Reviews | 4.8/5)</span>
</div>
<div id="media-box">
    <div id="media-carousel">
        </div>
    <div class="carousel-dots" id="carousel-dots"></div>
</div>
<div id="details-box">
    <p style="text-align: center; font-size: 0.9em; font-weight: 600; color: #666; margin-bottom: 5px;">Price Container</p>
    <div id="price-container">
        <div id="price-cod-display" class="price-item">
            <p class="price-label">Cash On Delivery</p>
            <p class="price-value">‚Çπ<span id="price-cod">...</span></p>
        </div>
        <div id="price-premium-display" class="price-item">
            <p class="price-label">Premium Price</p>
            <p class="price-value">‚Çπ<span id="price-premium">...</span></p>
        </div>
    </div>
    <p id="description-text">Loading...</p>
    <button id="buy-now-btn" class="btn-base primary-btn" disabled>üõí Loading Price...</button>
</div>
</div>
<div id="share-section-box">
<p id="share-label"><i class="fas fa-heart"></i> Add Your Name And Receiver Name</p>
<div id="share-input-group">
<div id="offer-timer-share">
<span id="offer-end-text">Offer End:</span>
<div id="countdown">00H : 00M : 00S</div>
</div>
<div class="share-input-row">
<input type="text" id="share-sender-input" class="share-input-field" placeholder="Your Name" autocomplete="off" value="Sunil">
<input type="text" id="share-receiver-input" class="share-input-field" placeholder="Friend Name" autocomplete="off" value="Ram">
</div>
<button id="share-btn" class="share-btn btn-base">Share Wish</button>
</div>
</div>
<div id="script-purchase-box">
<div class="script-text-group">
<p class="script-info">üéÅ Want to create your own store like this?</p>
<button id="buy-script-btn" class="script-btn btn-base">
<i class="fas fa-laptop-code"></i> Buy Script ‚Çπ<span id="script-price-display">1999</span>
</button>
</div>
<div class="qr-code-display">
<img src="qrcode.png" alt="Payment QR Code" id="phonepe-qr">
<p class="qr-code-label">Scan to Buy</p>
</div>
</div>
</div>
</div>
<audio id="tts-audio" src="" hidden></audio>
<div id="modal" class="hidden">
<div class="modal-content">
<span class="close-btn" onclick="hideModal()">√ó</span>
<div id="modal-body"></div>
</div>
</div>
<script>
// --- CONFIGURATION (FINALIZED) ---
const CONFIG={
// 1. **GOOGLE SCRIPT URL** - Your Web App URL
ORDER_SUBMIT_API:"https://script.google.com/macros/s/AKfycbyQoweTvVkWVWQRo72rNrJI_Qk4uw2TcLTRJwkvlr0ZWXrf6U3jnDOA9MKo7WPyEco8/exec", 
// 2. **YOUR WHATSAPP NUMBER**
ADMIN_WHATSAPP:"919226949557",
// 3. **DOMAIN LOCK KEY/BASE URL** - Set to your GitHub Pages URL
BASE_STORE_URL:"https://genzygifts.github.io/GenzyGifts/",
SCRIPT_PRICE:1999,
PRODUCT_JSON_FILE:"product_data.json"
};
let currentProduct=null,audioPlayed=!1, carouselTimer;

// --- UTILITY FUNCTIONS ---
function getUrlParams(){const params={};window.location.search.substring(1).split("&").forEach((pair=>{const[key,value]=pair.split("=").map(decodeURIComponent);key&&(params[key]=value)}),params);return params}
function showModal(content){document.getElementById("modal-body").innerHTML=content,document.getElementById("modal").classList.remove("hidden")}
function hideModal(){document.getElementById("modal").classList.add("hidden")}

// --- TIMER, AUDIO, DATA FETCHING ---
function startCountdown(){
const minutes=Math.floor(Math.random()*6)+10; 
let countDownDate=(new Date).getTime()+60*minutes*1e3;
const countdownElement=document.getElementById("countdown"),timerBoxElement=document.getElementById("offer-timer-share");
const buyBtn = document.getElementById("buy-now-btn");
const x=setInterval((function(){
const now=(new Date).getTime(),distance=countDownDate-now;
const hours=Math.floor(distance/(1e3*60*60))%24,minutes=Math.floor(distance/(1e3*60))%60,seconds=Math.floor(distance/1e3)%60;
countdownElement.innerHTML=(hours<10?"0"+hours:hours)+"H : "+(minutes<10?"0"+minutes:minutes)+"M : "+(seconds<10?"0"+seconds:seconds)+"S";
if (distance<0){
clearInterval(x);
countdownElement.innerHTML="EXPIRED!";
timerBoxElement.style.backgroundColor="#f8d7da";
buyBtn.textContent="‚è∞ Offer Ended! (Price May Change)";
buyBtn.disabled=!0;
}
}),1e3)
}

// --- TTS Logic: REVERTED TO PREVIOUS DYNAMIC VERSION ---
function generateTtsUrl(receiverName,senderName){
    const TTS_ENDPOINT="https://corsproxy.io/?https://translate.google.com/translate_tts?ie=UTF-8&tl=hi&client=tw-ob&q=";
    let ttsMessage;
    const params=getUrlParams(),shareStatus=params.status;

    if (shareStatus === "bought" && params.sender) {
        // Special message if the product has been bought by the sender
        ttsMessage=`‡§®‡§Æ‡§∏‡•ç‡§§‡•á ${receiverName}! ‡§Ü‡§™‡§ï‡•á ‡§¶‡•ã‡§∏‡•ç‡§§ ${senderName} ‡§®‡•á ‡§≠‡•Ä ‡§á‡§∏‡•á ‡§Ö‡§≠‡•Ä-‡§Ö‡§≠‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à ‡§î‡§∞ ‡§µ‡§π ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§Ø‡§π ‡§ë‡§´‡§∞ ‡§ñ‡§§‡•ç‡§Æ ‡§π‡•ã‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§Ü‡§™ ‡§≠‡•Ä ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç‡•§ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è Buy Now ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§`;
    } else if (params.sender) {
        // Standard wish message if shared but not bought (or status not set)
        ttsMessage=`‡§®‡§Æ‡§∏‡•ç‡§§‡•á ${receiverName}! ‡§Ø‡§π ‡§ë‡§´‡§∞ ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à! ${senderName} ‡§ï‡•ã ‡§Ø‡§π ‡§°‡•Ä‡§≤ ‡§¨‡§π‡•Å‡§§ ‡§™‡§∏‡§Ç‡§¶ ‡§Ü‡§à ‡§π‡•à, ‡§î‡§∞ ‡§µ‡§π ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§Ø‡§π ‡§ö‡§æ‡§Ç‡§∏ ‡§Ü‡§™ ‡§Æ‡§ø‡§∏ ‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è Buy Now ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ë‡§´‡§∞ ‡§ï‡§æ ‡§´‡§æ‡§Ø‡§¶‡§æ ‡§â‡§†‡§æ‡§è‡§Ç!`;
    } else {
        // Default message for direct traffic
        ttsMessage=`‡§®‡§Æ‡§∏‡•ç‡§§‡•á ‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ! ‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§°‡§æ‡§≤‡§ï‡•á ‡§µ‡§ø‡§∂ ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§∏‡•ç‡§™‡•á‡§∂‡§≤ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ë‡§´‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§`;
    }
    return TTS_ENDPOINT+encodeURIComponent(ttsMessage);
}

function playAudio(receiverName){
    const audio=document.getElementById("tts-audio");
    if(audioPlayed || !currentProduct) return;
    const params=getUrlParams(),senderName=params.sender?decodeURIComponent(params.sender):"Priya";
    audio.src=generateTtsUrl(receiverName,senderName);
    audio.onended = function() { audioPlayed = true; };
    const playPromise=audio.play();
    if(playPromise !== undefined) {
        playPromise.then(()=>{}).catch(error=>{
            audioPlayed = false;
        });
    }
}
function attemptAudioPlay(userInitiated=false){
    if(!audioPlayed && currentProduct){
        const params=getUrlParams();
        const receiverName=params.sender?decodeURIComponent(params.sender):"Priya"; 
        document.getElementById("receiver-display-top").textContent=receiverName;
        
        if(userInitiated || !audioPlayed) {
            playAudio(receiverName);
        }
    }
}
// --- END TTS Logic ---

async function fetchProductData(){
    try {
        const response = await fetch(CONFIG.PRODUCT_JSON_FILE);
        if (!response.ok) {
            throw new Error(`Failed to fetch ${CONFIG.PRODUCT_JSON_FILE}`);
        }
        const data = await response.json();
        currentProduct = data;
        updateStoreUI();
    } catch (error) {
        console.error("Error fetching product data:", error);
        document.getElementById("product-name-static").textContent = "Error Loading Product";
        document.getElementById("description-text").textContent = "Please check product_data.json file and your internet connection.";
        document.getElementById("buy-now-btn").disabled = true;
    }
}

function updateStoreUI(){
    if(!currentProduct) return;
    const params=getUrlParams(),finalReceiverName=params.sender?decodeURIComponent(params.sender):"Priya";
    
    document.getElementById("receiver-display-top").textContent=finalReceiverName;
    document.getElementById("product-name-static").textContent=currentProduct["Product Name"] || "Diwali Gift Box";
    document.getElementById("price-premium").textContent=currentProduct.Premium_Price || "999";
    document.getElementById("price-cod").textContent=currentProduct.COD_Price || "1150";
    document.getElementById("description-text").textContent=currentProduct.Description || "Experience the joy of giving...";
    document.getElementById("script-price-display").textContent=CONFIG.SCRIPT_PRICE;
    
    document.getElementById("buy-now-btn").textContent=`üõí Buy Now for ‚Çπ${currentProduct.Premium_Price || "999"}`;
    document.getElementById("buy-now-btn").disabled=false;
    
    startMediaDisplay();
    startCountdown();
}

function startMediaDisplay(){
    const mediaContainer=document.getElementById("media-carousel");
    mediaContainer.innerHTML=""; 
    clearInterval(carouselTimer); 
    
    const mediaCount = parseInt(currentProduct.Media_Count || 0);
    const hasVideo = currentProduct.Has_Video === true;
    
    if (hasVideo) {
        const video=document.createElement("video");
        video.src="1.mp4";
        video.className="product-media-video";
        video.setAttribute("loop","");
        video.setAttribute("autoplay","");
        video.setAttribute("playsinline","");
        video.setAttribute("controls","");
        video.muted=!0;
        mediaContainer.appendChild(video);
        
    } else if (mediaCount > 1) {
        let currentIndex = 1;
        
        const img = document.createElement("img");
        img.className="carousel-image active";
        img.src = `${currentIndex}.jpg`;
        img.style.objectFit = 'contain';
        mediaContainer.appendChild(img);
        
        carouselTimer = setInterval(() => {
            currentIndex = (currentIndex % mediaCount) + 1; 
            img.src = `${currentIndex}.jpg`;
        }, 3000); 
        
    } else if (mediaCount === 1) {
        const img = document.createElement("img");
        img.className="carousel-image active";
        img.src = "1.jpg";
        img.style.objectFit = 'contain';
        mediaContainer.appendChild(img);
        
    } else {
        mediaContainer.innerHTML = '<p style="position: absolute; top: 50%; width: 100%; text-align: center; color: #666; font-weight: 600;">No Media Available</p>';
    }
}
// --- ORDER FLOW LOGIC ---
function handleBuyNow(){
    if(!currentProduct) return void alert("Product details loading...");
    
    const codPrice = currentProduct.COD_Price || "1150"; 
    const premiumPrice = currentProduct.Premium_Price || "999"; 

    const content=`\n <h3 style="color: ${getComputedStyle(document.documentElement).getPropertyValue("--color-primary-btn")}; text-align: center;">Payment Option Chunain</h3>\n <p style="margin-bottom: 20px; text-align: center; font-weight: 500;">Apni suvidha ke anusaar Payment chunain:</p>\n \n <button class="btn-base" \n style="background-color: ${getComputedStyle(document.documentElement).getPropertyValue("--color-price-premium")}; color: white; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.5);" \n onclick="showOrderForm(true, '${premiumPrice}');">\n \u2b50 Premium Pay (\u20b9${premiumPrice})\n <p style="font-size: 0.8em; margin: 0;">(Fast Delivery, No Extra Charge)</p>\n </button>\n \n <button class="btn-base" \n style="background-color: ${getComputedStyle(document.documentElement).getPropertyValue("--color-price-cod")}; color: white; box-shadow: 0 4px 15px rgba(220, 53, 69, 0.5);" \n onclick="showOrderForm(false, '${codPrice}');">\n \ud83d\udcb0 COD (\u20b9${codPrice})\n <p style="font-size: 0.8em; margin: 0;">(Cash on Delivery)</p>\n </button>\n `;showModal(content)
}

function showOrderForm(isPrepaid, price){
    const paymentMode=isPrepaid?"PREMIUM":"COD",
    senderName=document.getElementById("receiver-display-top").textContent||"Direct Traffic"; 
    
    let formContent=`\n <h3 style="color: ${getComputedStyle(document.documentElement).getPropertyValue("--color-price-main")}; text-align: center;">${paymentMode} Order Form</h3>\n <p style="font-weight: 700; margin-bottom: 15px; text-align: center;">Aapka Final Price: \u20b9${price}</p>\n \n <form id="order-form" onsubmit="submitOrder(event, ${isPrepaid});">\n <input type="hidden" name="Product Name" value="${currentProduct["Product Name"] || 'Unknown Product'}">\n <input type="hidden" name="Price" value="${price}">\n <input type="hidden" name="Payment Mode" value="${paymentMode}">\n <input type="hidden" name="Wish Sender" value="${senderName}">\n \n <input type="text" name="Customer Name" placeholder="1. Full Name *" required autocomplete="name">\n <input type="text" name="Whatsapp" placeholder="2. Whatsapp Number *" pattern="[0-9]{10}" required title="Please enter a 10 digit mobile number." autocomplete="tel">\n <input type="text" name="Village" placeholder="3. Village *" required autocomplete="address-line3">\n <input type="text" name="Area" placeholder="4. Area/Road *" required autocomplete="address-line1">\n <input type="text" name="Taluka" placeholder="5. Taluka/City *" required autocomplete="address-level2">\n <input type="text" name="District" placeholder="6. Dist *" required autocomplete="address-level1">\n <input type="text" name="State" placeholder="7. State *" required autocomplete="address-level1">\n <input type="text" name="Pincode" placeholder="8. Pincode *" pattern="[0-9]{6}" required title="Please enter a 6 digit pincode." autocomplete="postal-code">\n <textarea name="Other Info" placeholder="9. Other Info (Optional)" rows="2" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 0.95em; outline: none;"></textarea>\n\n <button type="submit" class="primary-btn btn-base" style="margin-top: 10px; background: linear-gradient(135deg, #FF6B00, #FF8C00);">\n Place Order (\u20b9${price})\n </button>\n </form>\n `;showModal(formContent)
}

function submitOrder(event, isPrepaid){
    event.preventDefault();
    const form=document.getElementById("order-form");
    const formData=new FormData(form);
    const data={};
    formData.forEach(((value,key)=>{data[key]=value}));
    
    if (isPrepaid && !data.payment_done) {
        
        const qrContent=`\n <h3 style="color: ${getComputedStyle(document.documentElement).getPropertyValue("--color-price-premium")}; text-align: center;">\u2b50 Premium Payment</h3>\n <p style="font-weight: 700; margin-bottom: 15px; text-align: center;">Aapka Final Price: \u20b9${data.Price}</p>\n \n <div style="text-align: center; margin-bottom: 15px; padding: 10px; border: 1px dashed #FF8C00; border-radius: 8px;">\n <p style="font-weight: 700; color: #FF6B00; margin-bottom: 8px;">\n Payment Ke Liye QR Code Scan Karein:\n </p>\n <img src="qrcode.png" alt="Payment QR Code" style="width: 150px; height: 150px; border: 3px solid #FFD700; border-radius: 5px;">\n <p style="font-size: 0.8em; margin-top: 8px; color: #dc3545;">\n *Payment karne ke baad hi 'Confirm Order & Pay' button par click karein*\n </p>\n </div>\n\n <button type="button" class="primary-btn btn-base" style="margin-top: 10px; background: linear-gradient(135deg, #25D366, #128C7E);" onclick="finalSubmitOrder(event, data);">\n \u2705 Confirm Order & Pay (\u20b9${data.Price})\n </button>\n `;
        
        document.getElementById("modal-body").innerHTML = qrContent;
        return; 
    }
    
    finalSubmitOrder(event, data);
}

function finalSubmitOrder(event, data){
    document.getElementById("modal-body").innerHTML=`<h3 style="color: ${getComputedStyle(document.documentElement).getPropertyValue("--color-primary-btn")};">...Order Place Ho Raha Hai...</h3><p>Kripya thoda intezaar karein\u0964</p>`;
    
    const params=new URLSearchParams;
    for(const key in data) params.append(key, data[key]);
    
    fetch(CONFIG.ORDER_SUBMIT_API,{method:"POST",body:params})
    .then((response=>response.json()))
    .then((result=>{
        if("success"===result.result){
            const customerName=data["Customer Name"] || "Customer"; 
            
            document.getElementById("modal-body").innerHTML=`\n <h3 style="color:${getComputedStyle(document.documentElement).getPropertyValue("--color-price-premium")};">\ud83c\udf89 Order Successfully Placed!</h3>\n <p style="margin-bottom: 20px;">Aapka order mil gaya hai! Hamari team apko jald hi whatsapp par confirmation bhejegi\u0964</p>\n <button class="primary-btn btn-base" style="background-color: #25D366; margin-bottom: 10px;"\n onclick="hideModal(); showPostPurchaseShareModal('${customerName}');">\n \u2709\ufe0f Continue & Share Wish\n </button>\n <p style="font-size:0.8em; color:#555;">(Clicking above will open the Share Wish screen)</p>\n `;
        }else throw new Error(result.error||"Server error")
    }))
    .catch((error=>{
        document.getElementById("modal-body").innerHTML=`<h3 style="color: ${getComputedStyle(document.documentElement).getPropertyValue("--color-primary-btn")};">\u274c Order Place Nahi Ho Paya</h3><p style="margin-bottom: 20px;">Network problem ya server error. Kripya dobara try karein\u0964</p>`;
    }))
}

// Function to show the Share Wish pop-up
function showPostPurchaseShareModal(senderName){
    const receiverDefaultName=document.getElementById("share-receiver-input").value.trim() || "Ram"; 
    const content=`\n <h3 style="color: ${getComputedStyle(document.documentElement).getPropertyValue("--color-price-premium")}; text-align: center; margin-bottom: 10px;">\ud83c\udf89 Thank You for Your Purchase!</h3>\n <p style="margin-bottom: 15px; text-align: center; font-weight: 600;">Ab apni khushi apne dosto ke saath bhi share karein!</p>\n \n <div style="display: flex; flex-direction: column; gap: 10px;">\n <input type="text" id="modal-share-sender-input" value="${senderName}" placeholder="Your Name" readonly style="background-color: #f0f0f0; font-weight: bold; text-align: center;">\n <input type="text" id="modal-share-receiver-input" value="${receiverDefaultName}" placeholder="Friend Name (Jise aap wish bhejna chahte hain)" style="border: 2px solid #FF8C00; text-align: center;" autocomplete="off">\n <button class="primary-btn btn-base" \n style="margin-top: 10px; background: linear-gradient(135deg, #25D366, #128C7E); box-shadow: 0 4px 10px rgba(37, 211, 102, 0.5);"\n onclick="handleShareFromModal();">\n \u2709\ufe0f Share Wish Now!\n </button>\n </div>\n `;showModal(content)
}

function handleShareFromModal(){
    const senderName=document.getElementById("modal-share-sender-input").value.trim(),
    receiverNameInput=document.getElementById("modal-share-receiver-input").value.trim();
    
    if(!senderName || senderName === "Your Name") {
        alert("Kripya apna sahi naam daalein!");
        return;
    }
    
    // IMPORTANT: When sharing after purchase, we temporarily add status=bought to the URL
    // so that the next person opening the link gets the "bought" TTS message.
    const urlWithStatus = CONFIG.BASE_STORE_URL + `?status=bought`;
    
    if (receiverNameInput && receiverNameInput !== "Friend Name") {
        initiateWhatsAppShare(urlWithStatus, senderName, receiverNameInput);
    } else {
        initiateWhatsAppShare(urlWithStatus, senderName, senderName); 
    }
}

function handleShare(){
    const senderName=document.getElementById("share-sender-input").value.trim(),
    receiverNameInput=document.getElementById("share-receiver-input").value.trim();
    
    if(!senderName || senderName === "Your Name") {
        alert("Kripya apna sahi naam daalein!");
    } else if (receiverNameInput && receiverNameInput !== "Friend Name") {
        // Calls the main share logic - The base URL is used here (no status=bought)
        initiateWhatsAppShare(CONFIG.BASE_STORE_URL, senderName, receiverNameInput);
    } else {
        initiateWhatsAppShare(CONFIG.BASE_STORE_URL, senderName, senderName); 
    }
}

// --- CORE FUNCTION FOR WHATSAPP SHARE (TEXT FORMAT IS STATIC AS REQUESTED) ---
function initiateWhatsAppShare(baseShareUrl, senderName, receiverName){
    
    let finalShareUrl = baseShareUrl;
    
    // Append sender parameter for UI/TTS personalization
    const separator = finalShareUrl.includes('?') ? '&' : '?';
    
    // IMPORTANT: If 'status=bought' is already present (from modal), it will use '&'. Otherwise, it will use '?'
    finalShareUrl = finalShareUrl + separator + `sender=${encodeURIComponent(receiverName)}`;

    // 1. Bahot bada sender ka "name" bold text me (Uppercase for "Bahot Bada" effect)
    const SENDER_LINE = `*${senderName.toUpperCase()}*\n\n`;
    
    // 2. Exact wishing text
    const WISHING_TEXT = `|| ü•∞‚õÑ ‡§Ü‡§™‡§ï‡•ã ‡§î‡§∞ ‡§Ü‡§™‡§ï‡•á ‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§ï‡•ã ‡§Æ‡•á‡§∞‡•Ä ‡§ì‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§≠ ‡§¶‡•Ä‡§™‡§æ‡§µ‡§≤‡•Ä üå∑üíù || \n‡§Æ‡§æ‡§Å ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä ‡§î‡§∞ ‡§ó‡§£‡•á‡§∂ ‡§ú‡•Ä ‡§ï‡•Ä ‡§ï‡•É‡§™‡§æ ‡§Ü‡§™ ‡§™‡§∞ ‡§∏‡§¶‡§æ ‡§¨‡§®‡•Ä ‡§∞‡§π‡•á üå∑üôè ||\n\n`;
    
    // 3. New bold message with SEND instruction 
    const SEND_INSTRUCTION = `*‡§Ö‡§™‡§®‡•á ‡§®‡§æ‡§Æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ö‡§™‡§®‡•ã‡§Ç ‡§ï‡•ã (Wish Share) ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è "SEND" ‡§¨‡§ü‡§® click karte hi store open hona chahiye kunki send ye text diwali.gif pr all ready likhna hua hai*`;
    
    
    // The link must be the last part for WhatsApp to generate the preview correctly.
    const shareText = SENDER_LINE + WISHING_TEXT + SEND_INSTRUCTION + "\n" + finalShareUrl;
    
    // The OG tags will handle the image/title preview, and this text will appear in the chat.

    if(navigator.share){
        navigator.share({
            title: document.getElementById("og-title-meta").content, 
            text: shareText, 
            url: finalShareUrl 
        }).catch((error=>{
            window.open(`https://wa.me/?text=${encodeURIComponent(shareText)}`,"_blank");
        }));
    } else {
        window.open(`https://wa.me/?text=${encodeURIComponent(shareText)}`,"_blank");
    }
}
// --- END OF CORE FUNCTION ---

function handleBuyScript(){
    const whatsappMessage=`Hello! Mujhe \u20b9${CONFIG.SCRIPT_PRICE} mein viral wishing store script kharidni hai\u0964`;
    window.open(`https://wa.me/${CONFIG.ADMIN_WHATSAPP}?text=${encodeURIComponent(whatsappMessage)}`,"_blank");
}

// --- INITIALIZATION ---
function init(){
    const currentHost=window.location.host,expectedHost=(new URL(CONFIG.BASE_STORE_URL)).host;
    if (currentHost !== expectedHost && currentHost !== '127.0.0.1' && currentHost !== 'localhost') {
        document.getElementById("buy-now-btn").style.pointerEvents="none";
        document.getElementById("buy-now-btn").textContent="üîíSCRIPT LOCKED: Invalid Domain/Resale Attempt üîí";
        document.getElementById("share-btn").style.pointerEvents="none";
        document.getElementById("share-btn").textContent="üîí Locked";
        document.getElementById("script-purchase-box").classList.add("hidden");
    } else {
        fetchProductData(); 
        document.getElementById("buy-now-btn").addEventListener("click",handleBuyNow);
        document.getElementById("share-btn").addEventListener("click",handleShare);
        document.getElementById("buy-script-btn").addEventListener("click",handleBuyScript);
    }
    const params=getUrlParams(),initialReceiverName=params.sender?decodeURIComponent(params.sender):"Priya";
    document.getElementById("receiver-display-top").textContent = initialReceiverName;
}

document.addEventListener("DOMContentLoaded",init);
</script>
</body>
</html>
